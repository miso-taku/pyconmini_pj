# è©³ç´°è¨­è¨ˆæ›¸: åº—èˆ—å·¡å›ãƒ«ãƒ¼ãƒˆæœ€é©åŒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

## 1. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 1.1 å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Jupyter Notebook (main.ipynb)                 â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ã‚»ãƒ«1: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»è¨­å®š                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ã‚»ãƒ«2: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ã‚»ãƒ«3: åº—èˆ—æ¤œç´¢é–¢æ•°                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ã‚»ãƒ«4: è·é›¢è¨ˆç®—é–¢æ•°                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ã‚»ãƒ«5: ãƒ«ãƒ¼ãƒˆæœ€é©åŒ–é–¢æ•°                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ã‚»ãƒ«6: å¯è¦–åŒ–é–¢æ•°                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ã‚»ãƒ«7: ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¤–éƒ¨APIå±¤                              â”‚
â”‚  - Google Places API                                     â”‚
â”‚  - Google Maps Distance Matrix API                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
pyconmini_pj/
â”œâ”€â”€ .env                          # APIã‚­ãƒ¼è¨­å®šï¼ˆgitignoreå¯¾è±¡ï¼‰
â”œâ”€â”€ .env.example                  # APIã‚­ãƒ¼è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt              # ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”œâ”€â”€ README.md                     # å®Ÿè¡Œæ‰‹é †
â”œâ”€â”€ CLAUDE.md
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ requirements.md           # è¦æ±‚å®šç¾©æ›¸
â”‚   â””â”€â”€ design.md                 # æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â””â”€â”€ notebooks/
    â””â”€â”€ main.ipynb                # ãƒ¡ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ï¼ˆå…¨æ©Ÿèƒ½ã‚’å«ã‚€ï¼‰
```

## 2. Notebookã‚»ãƒ«æ§‹æˆè¨­è¨ˆ

### 2.1 ã‚»ãƒ«1: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨è¨­å®š

#### 2.1.1 è²¬å‹™
- å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- ç’°å¢ƒå¤‰æ•°ã‹ã‚‰APIã‚­ãƒ¼ã‚’èª­ã¿è¾¼ã¿
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã®å®šç¾©

#### 2.1.2 å®Ÿè£…å†…å®¹

```python
# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import os
from dotenv import load_dotenv
import googlemaps
import numpy as np
import pandas as pd
import mip
import ipyleaflet
from ipywidgets import HTML
from dataclasses import dataclass
from typing import List, Tuple, Optional

# ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿
load_dotenv()

# è¨­å®š
GOOGLE_MAPS_API_KEY = os.getenv("GOOGLE_MAPS_API_KEY")
MAX_SEARCH_RESULTS = 10
TRAVEL_MODE = "walking"
OPTIMIZATION_TIME_LIMIT = 30  # ç§’
WALKING_SPEED_KM_H = 4.0  # å¾’æ­©é€Ÿåº¦ km/h

# APIã‚­ãƒ¼ã®æ¤œè¨¼
if not GOOGLE_MAPS_API_KEY:
    raise ValueError("âŒ GOOGLE_MAPS_API_KEYãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")

# Google Maps ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
gmaps = googlemaps.Client(key=GOOGLE_MAPS_API_KEY)

print("âœ… è¨­å®šå®Œäº†")
print(f"ğŸ“ æœ€å¤§æ¤œç´¢çµæœæ•°: {MAX_SEARCH_RESULTS}ä»¶")
print(f"ğŸš¶ ç§»å‹•æ‰‹æ®µ: {TRAVEL_MODE}")
```

### 2.2 ã‚»ãƒ«2: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©

#### 2.2.1 è²¬å‹™
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§ä½¿ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©

#### 2.2.2 å®Ÿè£…å†…å®¹

```python
@dataclass
class Location:
    """ä½ç½®æƒ…å ±ã‚’è¡¨ã™ã‚¯ãƒ©ã‚¹"""
    lat: float  # ç·¯åº¦
    lng: float  # çµŒåº¦

    def __post_init__(self):
        if not (-90 <= self.lat <= 90):
            raise ValueError(f"ç·¯åº¦ãŒç¯„å›²å¤–ã§ã™: {self.lat}")
        if not (-180 <= self.lng <= 180):
            raise ValueError(f"çµŒåº¦ãŒç¯„å›²å¤–ã§ã™: {self.lng}")

    def to_tuple(self) -> Tuple[float, float]:
        return (self.lat, self.lng)


@dataclass
class Place:
    """åº—èˆ—æƒ…å ±ã‚’è¡¨ã™ã‚¯ãƒ©ã‚¹"""
    place_id: str
    name: str
    address: str
    location: Location
    distance_from_station: Optional[float] = None  # ãƒ¡ãƒ¼ãƒˆãƒ«

    def to_dict(self) -> dict:
        return {
            "åº—èˆ—å": self.name,
            "ä½æ‰€": self.address,
            "é§…ã‹ã‚‰ã®è·é›¢": f"{self.distance_from_station:.0f}m" if self.distance_from_station else "N/A"
        }


@dataclass
class Station:
    """é§…æƒ…å ±ã‚’è¡¨ã™ã‚¯ãƒ©ã‚¹"""
    name: str
    location: Location

    def to_tuple(self) -> Tuple[float, float]:
        return self.location.to_tuple()


@dataclass
class Route:
    """æœ€é©åŒ–ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆæƒ…å ±ã‚’è¡¨ã™ã‚¯ãƒ©ã‚¹"""
    station: Station
    places: List[Place]  # æœ€é©é †åº
    total_distance: float  # ãƒ¡ãƒ¼ãƒˆãƒ«
    segment_distances: List[float]  # å„åŒºé–“ã®è·é›¢ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ï¼‰

    @property
    def estimated_time(self) -> float:
        """æ¨å®šæ‰€è¦æ™‚é–“ï¼ˆåˆ†ï¼‰"""
        return (self.total_distance / 1000) / WALKING_SPEED_KM_H * 60

    def to_dataframe(self) -> pd.DataFrame:
        """ãƒ«ãƒ¼ãƒˆè©³ç´°ã®DataFrameã‚’ä½œæˆ"""
        data = []
        cumulative_distance = 0

        for i, place in enumerate(self.places, 1):
            segment_dist = self.segment_distances[i-1]
            cumulative_distance += segment_dist
            data.append({
                "è¨ªå•é †": i,
                "åº—èˆ—å": place.name,
                "å‰åœ°ç‚¹ã‹ã‚‰ã®è·é›¢": f"{segment_dist:.0f}m",
                "ç´¯ç©è·é›¢": f"{cumulative_distance:.0f}m"
            })

        return pd.DataFrame(data)

    def summary(self) -> pd.DataFrame:
        """ã‚µãƒãƒªãƒ¼æƒ…å ±ã®DataFrameã‚’ä½œæˆ"""
        data = {
            "é …ç›®": ["ç·ç§»å‹•è·é›¢", "æ¨å®šæ‰€è¦æ™‚é–“", "è¨ªå•åº—èˆ—æ•°"],
            "å€¤": [
                f"{self.total_distance:.0f}m ({self.total_distance/1000:.2f}km)",
                f"{self.estimated_time:.1f}åˆ†",
                f"{len(self.places)}ä»¶"
            ]
        }
        return pd.DataFrame(data)

print("âœ… ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©å®Œäº†")
```

### 2.3 ã‚»ãƒ«3: åº—èˆ—æ¤œç´¢é–¢æ•°

#### 2.3.1 è²¬å‹™
- é§…ã®ä½ç½®æƒ…å ±å–å¾—
- åº—èˆ—æ¤œç´¢

#### 2.3.2 å®Ÿè£…å†…å®¹

```python
def search_station(station_name: str) -> Station:
    """
    é§…åã‹ã‚‰é§…ã®ä½ç½®æƒ…å ±ã‚’å–å¾—

    Args:
        station_name: é§…å

    Returns:
        Station: é§…æƒ…å ±ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

    Raises:
        ValueError: é§…ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
    """
    try:
        result = gmaps.geocode(address=station_name, language="ja")

        if not result:
            raise ValueError(f"'{station_name}' ã«è©²å½“ã™ã‚‹é§…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")

        location_data = result[0]["geometry"]["location"]
        location = Location(lat=location_data["lat"], lng=location_data["lng"])

        return Station(name=station_name, location=location)

    except Exception as e:
        if isinstance(e, ValueError):
            raise
        raise ValueError(f"é§…ã®æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")


def search_nearby_places(station: Station, keyword: str, max_results: int = MAX_SEARCH_RESULTS) -> List[Place]:
    """
    é§…å‘¨è¾ºã®åº—èˆ—ã‚’æ¤œç´¢

    Args:
        station: é§…æƒ…å ±
        keyword: æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        max_results: æœ€å¤§å–å¾—ä»¶æ•°

    Returns:
        List[Place]: åº—èˆ—ãƒªã‚¹ãƒˆï¼ˆé§…ã‹ã‚‰è¿‘ã„é †ï¼‰

    Raises:
        ValueError: æ¤œç´¢çµæœãŒ0ä»¶ã®å ´åˆ
    """
    try:
        result = gmaps.places_nearby(
            location=station.to_tuple(),
            keyword=keyword,
            rank_by="distance",
            language="ja"
        )

        if not result.get("results"):
            raise ValueError(f"'{keyword}' ã«è©²å½“ã™ã‚‹åº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")

        places = []
        for place_data in result["results"][:max_results]:
            location_data = place_data["geometry"]["location"]
            location = Location(lat=location_data["lat"], lng=location_data["lng"])

            place = Place(
                place_id=place_data["place_id"],
                name=place_data["name"],
                address=place_data.get("vicinity", "ä½æ‰€æƒ…å ±ãªã—"),
                location=location
            )
            places.append(place)

        if len(places) < max_results:
            print(f"âš ï¸ æ¤œç´¢çµæœãŒ{len(places)}ä»¶ã®ã¿ã§ã—ãŸ")

        return places

    except Exception as e:
        if isinstance(e, ValueError):
            raise
        raise ValueError(f"åº—èˆ—æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")


print("âœ… åº—èˆ—æ¤œç´¢é–¢æ•°å®šç¾©å®Œäº†")
```

### 2.4 ã‚»ãƒ«4: è·é›¢è¨ˆç®—é–¢æ•°

#### 2.4.1 è²¬å‹™
- è·é›¢è¡Œåˆ—ã®è¨ˆç®—

#### 2.4.2 å®Ÿè£…å†…å®¹

```python
def calculate_distance_matrix(station: Station, places: List[Place]) -> np.ndarray:
    """
    é§…ã¨å…¨åº—èˆ—é–“ã®è·é›¢è¡Œåˆ—ã‚’è¨ˆç®—

    è·é›¢è¡Œåˆ—ã®æ§‹é€ :
    - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹0: é§…
    - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹1ã€œN: å„åº—èˆ—

    Args:
        station: é§…æƒ…å ±
        places: åº—èˆ—ãƒªã‚¹ãƒˆ

    Returns:
        np.ndarray: è·é›¢è¡Œåˆ— (N+1 x N+1)
    """
    # å…¨åœ°ç‚¹ã®ä½ç½®æƒ…å ±ãƒªã‚¹ãƒˆã‚’ä½œæˆ
    locations = [station.to_tuple()] + [place.location.to_tuple() for place in places]
    num_locations = len(locations)

    # è·é›¢è¡Œåˆ—ã‚’åˆæœŸåŒ–
    distance_matrix = np.zeros((num_locations, num_locations))

    try:
        # Distance Matrix APIã‚’å‘¼ã³å‡ºã—
        result = gmaps.distance_matrix(
            origins=locations,
            destinations=locations,
            mode=TRAVEL_MODE,
            language="ja",
            units="metric"
        )

        # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰è·é›¢ã‚’æŠ½å‡º
        for i in range(num_locations):
            for j in range(num_locations):
                if i == j:
                    distance_matrix[i][j] = 0
                else:
                    element = result["rows"][i]["elements"][j]
                    if element["status"] == "OK":
                        distance_matrix[i][j] = element["distance"]["value"]  # ãƒ¡ãƒ¼ãƒˆãƒ«
                    else:
                        # çµŒè·¯ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯å¤§ããªå€¤ã‚’è¨­å®š
                        distance_matrix[i][j] = 999999
                        print(f"âš ï¸ åœ°ç‚¹{i}ã‹ã‚‰åœ°ç‚¹{j}ã¸ã®çµŒè·¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")

        # åº—èˆ—ã«é§…ã‹ã‚‰ã®è·é›¢ã‚’è¨­å®š
        for idx, place in enumerate(places, 1):
            place.distance_from_station = distance_matrix[0][idx]

        return distance_matrix

    except Exception as e:
        raise ValueError(f"è·é›¢è¨ˆç®—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")


print("âœ… è·é›¢è¨ˆç®—é–¢æ•°å®šç¾©å®Œäº†")
```

### 2.5 ã‚»ãƒ«5: ãƒ«ãƒ¼ãƒˆæœ€é©åŒ–é–¢æ•°

#### 2.5.1 è²¬å‹™
- TSPå•é¡Œã®å®šå¼åŒ–ã¨æ±‚è§£

#### 2.5.2 å®Ÿè£…å†…å®¹

```python
def optimize_route(station: Station, places: List[Place], distance_matrix: np.ndarray) -> Route:
    """
    TSPã¨ã—ã¦æœ€é©ãƒ«ãƒ¼ãƒˆã‚’è¨ˆç®—

    Args:
        station: é§…æƒ…å ±
        places: åº—èˆ—ãƒªã‚¹ãƒˆ
        distance_matrix: è·é›¢è¡Œåˆ—

    Returns:
        Route: æœ€é©åŒ–ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆæƒ…å ±
    """
    n = len(distance_matrix)  # åœ°ç‚¹æ•°ï¼ˆé§… + åº—èˆ—ï¼‰

    # ãƒ¢ãƒ‡ãƒ«ä½œæˆ
    model = mip.Model(sense=mip.MINIMIZE)
    model.verbose = 0  # ãƒ­ã‚°ã‚’æŠ‘åˆ¶

    # æ±ºå®šå¤‰æ•°: x[i][j] = åœ°ç‚¹iã‹ã‚‰åœ°ç‚¹jã¸ç§»å‹•ã™ã‚‹ã‹ï¼ˆ1 or 0ï¼‰
    x = [[model.add_var(var_type=mip.BINARY) for j in range(n)] for i in range(n)]

    # è£œåŠ©å¤‰æ•°: u[i] = åœ°ç‚¹iã®è¨ªå•é †åºï¼ˆéƒ¨åˆ†å·¡å›è·¯é™¤å»ç”¨ï¼‰
    u = [model.add_var(var_type=mip.INTEGER, lb=1, ub=n-1) for i in range(n)]

    # ç›®çš„é–¢æ•°: ç·ç§»å‹•è·é›¢ã®æœ€å°åŒ–
    model.objective = mip.xsum(distance_matrix[i][j] * x[i][j] for i in range(n) for j in range(n))

    # åˆ¶ç´„1: å„åœ°ç‚¹ã‹ã‚‰å‡ºã‚‹è¾ºã¯1æœ¬ã®ã¿
    for i in range(n):
        model += mip.xsum(x[i][j] for j in range(n) if i != j) == 1

    # åˆ¶ç´„2: å„åœ°ç‚¹ã«å…¥ã‚‹è¾ºã¯1æœ¬ã®ã¿
    for j in range(n):
        model += mip.xsum(x[i][j] for i in range(n) if i != j) == 1

    # åˆ¶ç´„3: éƒ¨åˆ†å·¡å›è·¯ã®é™¤å»ï¼ˆMTZåˆ¶ç´„ï¼‰
    for i in range(1, n):
        for j in range(1, n):
            if i != j:
                model += u[i] - u[j] + n * x[i][j] <= n - 1

    # æ±‚è§£
    status = model.optimize(max_seconds=OPTIMIZATION_TIME_LIMIT)

    if status != mip.OptimizationStatus.OPTIMAL and status != mip.OptimizationStatus.FEASIBLE:
        raise ValueError("æœ€é©åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“åˆ¶é™å†…ã«è§£ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")

    # è§£ã‹ã‚‰è¨ªå•é †åºã‚’æŠ½å‡º
    current = 0  # é§…ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ
    visit_order = [0]
    visited = {0}

    while len(visited) < n:
        for j in range(n):
            if j not in visited and x[current][j].x > 0.5:
                visit_order.append(j)
                visited.add(j)
                current = j
                break

    # Routeã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰
    optimized_places = [places[i-1] for i in visit_order[1:-1]]  # é§…ã‚’é™¤ã

    # å„åŒºé–“ã®è·é›¢ã‚’è¨ˆç®—
    segment_distances = []
    for i in range(len(visit_order) - 1):
        segment_distances.append(distance_matrix[visit_order[i]][visit_order[i+1]])

    total_distance = sum(segment_distances)

    # æœ€å¾Œã®åº—èˆ—ã‹ã‚‰é§…ã¸ã®è·é›¢ã¯é™¤å¤–ï¼ˆè¡¨ç¤ºç”¨ï¼‰
    segment_distances_without_return = segment_distances[:-1]

    return Route(
        station=station,
        places=optimized_places,
        total_distance=total_distance,
        segment_distances=segment_distances_without_return
    )


print("âœ… ãƒ«ãƒ¼ãƒˆæœ€é©åŒ–é–¢æ•°å®šç¾©å®Œäº†")
```

### 2.6 ã‚»ãƒ«6: å¯è¦–åŒ–é–¢æ•°

#### 2.6.1 è²¬å‹™
- åœ°å›³è¡¨ç¤º
- è¡¨å½¢å¼è¡¨ç¤º

#### 2.6.2 å®Ÿè£…å†…å®¹

```python
def visualize_search_results(station: Station, places: List[Place]) -> ipyleaflet.Map:
    """
    æ¤œç´¢çµæœã‚’åœ°å›³ä¸Šã«è¡¨ç¤º

    Args:
        station: é§…æƒ…å ±
        places: åº—èˆ—ãƒªã‚¹ãƒˆ

    Returns:
        ipyleaflet.Map: æ¤œç´¢çµæœã‚’è¡¨ç¤ºã—ãŸåœ°å›³
    """
    # ä¸­å¿ƒä½ç½®ã‚’è¨ˆç®—
    center = station.to_tuple()

    # åœ°å›³ä½œæˆ
    m = ipyleaflet.Map(center=center, zoom=14)

    # é§…ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
    station_marker = ipyleaflet.Marker(
        location=center,
        draggable=False,
        title=station.name,
        icon=ipyleaflet.AwesomeIcon(name='train', marker_color='blue')
    )
    m.add_layer(station_marker)

    # åº—èˆ—ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
    for place in places:
        marker = ipyleaflet.Marker(
            location=place.location.to_tuple(),
            draggable=False,
            title=place.name,
            icon=ipyleaflet.AwesomeIcon(name='store', marker_color='red')
        )

        # ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
        popup_html = f"""
        <b>{place.name}</b><br>
        {place.address}<br>
        é§…ã‹ã‚‰: {place.distance_from_station:.0f}m
        """
        popup = ipyleaflet.Popup(
            location=place.location.to_tuple(),
            child=HTML(popup_html),
            close_button=True,
            auto_close=True
        )
        marker.popup = popup
        m.add_layer(marker)

    return m


def visualize_optimized_route(route: Route) -> ipyleaflet.Map:
    """
    æœ€é©åŒ–ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã‚’åœ°å›³ä¸Šã«è¡¨ç¤º

    Args:
        route: ãƒ«ãƒ¼ãƒˆæƒ…å ±

    Returns:
        ipyleaflet.Map: ãƒ«ãƒ¼ãƒˆã‚’è¡¨ç¤ºã—ãŸåœ°å›³
    """
    # ä¸­å¿ƒä½ç½®ã‚’è¨ˆç®—
    center = route.station.to_tuple()

    # åœ°å›³ä½œæˆ
    m = ipyleaflet.Map(center=center, zoom=14)

    # é§…ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
    station_marker = ipyleaflet.Marker(
        location=center,
        draggable=False,
        title=route.station.name,
        icon=ipyleaflet.AwesomeIcon(name='train', marker_color='blue')
    )
    m.add_layer(station_marker)

    # åº—èˆ—ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ ï¼ˆè¨ªå•é †ã«ç•ªå·ä»˜ãï¼‰
    for idx, place in enumerate(route.places, 1):
        marker = ipyleaflet.Marker(
            location=place.location.to_tuple(),
            draggable=False,
            title=f"{idx}. {place.name}",
            icon=ipyleaflet.AwesomeIcon(
                name='info',
                marker_color='green',
                icon_color='white'
            )
        )

        # ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
        popup_html = f"""
        <b>è¨ªå•é †: {idx}</b><br>
        <b>{place.name}</b><br>
        {place.address}
        """
        popup = ipyleaflet.Popup(
            location=place.location.to_tuple(),
            child=HTML(popup_html),
            close_button=True,
            auto_close=True
        )
        marker.popup = popup
        m.add_layer(marker)

    # ãƒ«ãƒ¼ãƒˆç·šã‚’è¿½åŠ 
    route_coords = [route.station.to_tuple()]
    route_coords.extend([place.location.to_tuple() for place in route.places])
    route_coords.append(route.station.to_tuple())  # é§…ã«æˆ»ã‚‹

    polyline = ipyleaflet.Polyline(
        locations=route_coords,
        color="blue",
        fill=False,
        weight=3
    )
    m.add_layer(polyline)

    return m


def display_search_results_table(places: List[Place]) -> pd.DataFrame:
    """
    æ¤œç´¢çµæœã‚’è¡¨å½¢å¼ã§è¡¨ç¤º

    Args:
        places: åº—èˆ—ãƒªã‚¹ãƒˆ

    Returns:
        pd.DataFrame: è¡¨ç¤ºç”¨DataFrame
    """
    data = []
    for idx, place in enumerate(places, 1):
        data.append({
            "ç•ªå·": idx,
            "åº—èˆ—å": place.name,
            "ä½æ‰€": place.address,
            "é§…ã‹ã‚‰ã®è·é›¢": f"{place.distance_from_station:.0f}m" if place.distance_from_station else "N/A"
        })
    return pd.DataFrame(data)


print("âœ… å¯è¦–åŒ–é–¢æ•°å®šç¾©å®Œäº†")
```

### 2.7 ã‚»ãƒ«7: ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ

#### 2.7.1 è²¬å‹™
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å—ä»˜
- å„é–¢æ•°ã®å‘¼ã³å‡ºã—
- çµæœã®è¡¨ç¤º

#### 2.7.2 å®Ÿè£…å†…å®¹

```python
# ========================================
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
# ========================================
STATION_NAME = "æ–°å®¿é§…"      # é§…åã‚’å…¥åŠ›
KEYWORD = "ã‚«ãƒ•ã‚§"            # æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›

print("="*60)
print(f"ğŸš‰ é§…: {STATION_NAME}")
print(f"ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: {KEYWORD}")
print("="*60)

try:
    # ========================================
    # 1. é§…ã®æ¤œç´¢
    # ========================================
    print("\nğŸ“ é§…ã‚’æ¤œç´¢ä¸­...")
    station = search_station(STATION_NAME)
    print(f"âœ… é§…ã®ä½ç½®æƒ…å ±å–å¾—å®Œäº†: {station.location.lat:.6f}, {station.location.lng:.6f}")

    # ========================================
    # 2. åº—èˆ—ã®æ¤œç´¢
    # ========================================
    print(f"\nğŸª '{KEYWORD}' ã‚’æ¤œç´¢ä¸­...")
    places = search_nearby_places(station, KEYWORD)
    print(f"âœ… {len(places)}ä»¶ã®åº—èˆ—ã‚’å–å¾—ã—ã¾ã—ãŸ")

    # æ¤œç´¢çµæœã‚’è¡¨ç¤º
    print("\nğŸ“Š æ¤œç´¢çµæœï¼ˆé§…ã‹ã‚‰è¿‘ã„é †ï¼‰:")
    df_search = display_search_results_table(places)
    display(df_search)

    print("\nğŸ—ºï¸ æ¤œç´¢çµæœã®åœ°å›³è¡¨ç¤º:")
    map_search = visualize_search_results(station, places)
    display(map_search)

    # ========================================
    # 3. è·é›¢è¡Œåˆ—ã®è¨ˆç®—
    # ========================================
    print("\nğŸ“ è·é›¢è¡Œåˆ—ã‚’è¨ˆç®—ä¸­...")
    distance_matrix = calculate_distance_matrix(station, places)
    print(f"âœ… è·é›¢è¡Œåˆ—è¨ˆç®—å®Œäº† ({len(distance_matrix)}x{len(distance_matrix)})")

    # ========================================
    # 4. ãƒ«ãƒ¼ãƒˆã®æœ€é©åŒ–
    # ========================================
    print("\nğŸ”§ æœ€é©ãƒ«ãƒ¼ãƒˆã‚’è¨ˆç®—ä¸­...")
    route = optimize_route(station, places, distance_matrix)
    print(f"âœ… æœ€é©åŒ–å®Œäº†")

    # ãƒ«ãƒ¼ãƒˆè©³ç´°ã‚’è¡¨ç¤º
    print("\nğŸ“Š æœ€é©ãƒ«ãƒ¼ãƒˆè©³ç´°:")
    df_route = route.to_dataframe()
    display(df_route)

    print("\nğŸ“ˆ ã‚µãƒãƒªãƒ¼:")
    df_summary = route.summary()
    display(df_summary)

    print("\nğŸ—ºï¸ æœ€é©ãƒ«ãƒ¼ãƒˆã®åœ°å›³è¡¨ç¤º:")
    map_route = visualize_optimized_route(route)
    display(map_route)

    print("\n" + "="*60)
    print("âœ… ã™ã¹ã¦ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
    print("="*60)

except ValueError as e:
    print(f"\nâŒ ã‚¨ãƒ©ãƒ¼: {e}")
    print("ğŸ’¡ å…¥åŠ›å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„")
except Exception as e:
    print(f"\nâŒ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {e}")
    print("ğŸ’¡ APIã‚­ãƒ¼ã‚„è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„")
```

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 3.1 å‡¦ç†ãƒ•ãƒ­ãƒ¼å›³

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›]
  é§…åã€æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
    â†“
[ã‚»ãƒ«7: ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–‹å§‹]
    â†“
[ã‚»ãƒ«3: search_station()]
  â†’ Google Geocoding API
  â†’ Station ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
    â†“
[ã‚»ãƒ«3: search_nearby_places()]
  â†’ Google Places API
  â†’ Place ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒªã‚¹ãƒˆä½œæˆ
    â†“
[ã‚»ãƒ«6: æ¤œç´¢çµæœã®è¡¨ç¤º]
  â†’ DataFrameè¡¨ç¤º
  â†’ åœ°å›³è¡¨ç¤ºï¼ˆipyleafletï¼‰
    â†“
[ã‚»ãƒ«4: calculate_distance_matrix()]
  â†’ Google Distance Matrix API
  â†’ è·é›¢è¡Œåˆ—ï¼ˆnumpyé…åˆ—ï¼‰ä½œæˆ
    â†“
[ã‚»ãƒ«5: optimize_route()]
  â†’ Python-MIP ã«ã‚ˆã‚‹TSPæ±‚è§£
  â†’ Route ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
    â†“
[ã‚»ãƒ«6: æœ€é©ãƒ«ãƒ¼ãƒˆã®è¡¨ç¤º]
  â†’ DataFrameè¡¨ç¤ºï¼ˆè©³ç´°ãƒ»ã‚µãƒãƒªãƒ¼ï¼‰
  â†’ åœ°å›³è¡¨ç¤ºï¼ˆãƒ«ãƒ¼ãƒˆæç”»ï¼‰
    â†“
[å®Œäº†]
```

## 4. APIè¨­è¨ˆ

### 4.1 å¤–éƒ¨APIå‘¼ã³å‡ºã—ä»•æ§˜

#### 4.1.1 Google Geocoding API

**ä½¿ç”¨ç®‡æ‰€**: `search_station()`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```python
gmaps.geocode(address="æ–°å®¿é§…", language="ja")
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```python
[{
    "geometry": {"location": {"lat": 35.6896, "lng": 139.7006}},
    "formatted_address": "æ—¥æœ¬ã€æ±äº¬éƒ½æ–°å®¿åŒº..."
}]
```

#### 4.1.2 Google Places API (Nearby Search)

**ä½¿ç”¨ç®‡æ‰€**: `search_nearby_places()`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```python
gmaps.places_nearby(
    location=(35.6896, 139.7006),
    keyword="ã‚«ãƒ•ã‚§",
    rank_by="distance",
    language="ja"
)
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```python
{
    "results": [
        {
            "place_id": "ChIJ...",
            "name": "ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹",
            "vicinity": "æ±äº¬éƒ½æ–°å®¿åŒº...",
            "geometry": {"location": {"lat": 35.6900, "lng": 139.7010}}
        }
    ]
}
```

#### 4.1.3 Google Distance Matrix API

**ä½¿ç”¨ç®‡æ‰€**: `calculate_distance_matrix()`

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```python
gmaps.distance_matrix(
    origins=[(35.6896, 139.7006), ...],
    destinations=[(35.6900, 139.7010), ...],
    mode="walking",
    language="ja",
    units="metric"
)
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**:
```python
{
    "rows": [
        {
            "elements": [
                {"distance": {"value": 450}, "status": "OK"}
            ]
        }
    ]
}
```

## 5. TSPæœ€é©åŒ–ã®æ•°ç†ãƒ¢ãƒ‡ãƒ«

### 5.1 æ±ºå®šå¤‰æ•°

- `x[i][j]`: åœ°ç‚¹iã‹ã‚‰åœ°ç‚¹jã¸ç§»å‹•ã™ã‚‹å ´åˆ1ã€ã—ãªã„å ´åˆ0ï¼ˆäºŒå€¤å¤‰æ•°ï¼‰
- `u[i]`: åœ°ç‚¹iã®è¨ªå•é †åºï¼ˆæ•´æ•°å¤‰æ•°ã€éƒ¨åˆ†å·¡å›è·¯é™¤å»ç”¨ï¼‰

### 5.2 ç›®çš„é–¢æ•°

```
minimize: Î£(i,j) distance[i][j] * x[i][j]
```

### 5.3 åˆ¶ç´„æ¡ä»¶

1. **å„åœ°ç‚¹ã‹ã‚‰å‡ºã‚‹è¾ºã¯1æœ¬**: `Î£(j) x[i][j] = 1` for all i
2. **å„åœ°ç‚¹ã«å…¥ã‚‹è¾ºã¯1æœ¬**: `Î£(i) x[i][j] = 1` for all j
3. **éƒ¨åˆ†å·¡å›è·¯ã®é™¤å»ï¼ˆMTZåˆ¶ç´„ï¼‰**: `u[i] - u[j] + n*x[i][j] <= n-1` for all iâ‰ j (i,j â‰  0)
4. **è¨ªå•é †åºã®ç¯„å›²**: `1 <= u[i] <= n-1` for all i â‰  0

## 6. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 6.1 ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ã¨å¯¾å¿œ

| ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | æ¤œå‡ºç®‡æ‰€ | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹ | å¯¾å¿œ |
|-----------|---------|------------------|------|
| APIã‚­ãƒ¼æœªè¨­å®š | ã‚»ãƒ«1 | `GOOGLE_MAPS_API_KEYãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“` | .envç¢ºèªã‚’ä¿ƒã™ |
| é§…ãŒè¦‹ã¤ã‹ã‚‰ãªã„ | `search_station()` | `'æ–°å®¿' ã«è©²å½“ã™ã‚‹é§…ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ` | é§…åã®å†å…¥åŠ›ã‚’ä¿ƒã™ |
| åº—èˆ—ãŒè¦‹ã¤ã‹ã‚‰ãªã„ | `search_nearby_places()` | `'ã‚«ãƒ•ã‚§' ã«è©²å½“ã™ã‚‹åº—èˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ` | ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ã‚’ä¿ƒã™ |
| APIå‘¼ã³å‡ºã—å¤±æ•— | å„APIé–¢æ•° | `APIã‚¨ãƒ©ãƒ¼: ...` | æ¥ç¶šãƒ»èªè¨¼ç¢ºèªã‚’ä¿ƒã™ |
| æœ€é©åŒ–å¤±æ•— | `optimize_route()` | `æœ€é©åŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ` | ãƒ‡ãƒ¼ã‚¿ç¢ºèªã‚’ä¿ƒã™ |

### 6.2 ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­è¨ˆ

**åŸºæœ¬ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**:
```
âŒ ã‚¨ãƒ©ãƒ¼: [ã‚¨ãƒ©ãƒ¼å†…å®¹]
ğŸ’¡ [å¯¾å‡¦æ³•]
```

## 7. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### 7.1 APIã‚­ãƒ¼ç®¡ç†

**.envãƒ•ã‚¡ã‚¤ãƒ«**:
```
GOOGLE_MAPS_API_KEY=your_api_key_here
```

**.env.exampleï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰**:
```
GOOGLE_MAPS_API_KEY=your_google_maps_api_key
```

**.gitignore**:
```
.env
```

### 7.2 å…¥åŠ›æ¤œè¨¼

- é§…å: ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯ï¼ˆé–¢æ•°å†…ã§å®Ÿæ–½ï¼‰
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯ï¼ˆé–¢æ•°å†…ã§å®Ÿæ–½ï¼‰
- åº§æ¨™: ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã®`__post_init__`ã§ç¯„å›²ãƒã‚§ãƒƒã‚¯

## 8. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆ

### 8.1 å‡¦ç†æ™‚é–“ç›®æ¨™

| å‡¦ç† | ç›®æ¨™æ™‚é–“ |
|------|----------|
| é§…ã®æ¤œç´¢ | 1ç§’ä»¥å†… |
| åº—èˆ—æ¤œç´¢ | 3ç§’ä»¥å†… |
| è·é›¢è¡Œåˆ—è¨ˆç®— | 5ç§’ä»¥å†… |
| TSPæœ€é©åŒ– | 30ç§’ä»¥å†… |
| åœ°å›³æç”» | 2ç§’ä»¥å†… |
| **åˆè¨ˆ** | **45ç§’ä»¥å†…** |

### 8.2 æœ€é©åŒ–æ‰‹æ³•

- Distance Matrix APIã¯1å›ã®å‘¼ã³å‡ºã—ã§å…¨è·é›¢ã‚’å–å¾—ï¼ˆ11x11è¡Œåˆ—ï¼‰
- Python-MIPã®CBCã‚½ãƒ«ãƒãƒ¼ä½¿ç”¨ï¼ˆ10åœ°ç‚¹ã®TSPã¯é«˜é€Ÿã«å³å¯†è§£ã‚’è¨ˆç®—å¯èƒ½ï¼‰

## 9. ãƒ†ã‚¹ãƒˆè¨­è¨ˆ

### 9.1 ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

**æ­£å¸¸ç³»**:
1. æ–°å®¿é§… + ã‚«ãƒ•ã‚§
2. æ¸‹è°·é§… + ã‚³ãƒ³ãƒ“ãƒ‹
3. éŒå€‰é§… + è¦³å…‰åœ°

**ç•°å¸¸ç³»**:
1. å­˜åœ¨ã—ãªã„é§…å
2. æ¤œç´¢çµæœ0ä»¶ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
3. APIã‚­ãƒ¼æœªè¨­å®š

## 10. é‹ç”¨è¨­è¨ˆ

### 10.1 åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. uvã§ä»®æƒ³ç’°å¢ƒã‚’æ§‹ç¯‰
2. `uv pip install -r requirements.txt`
3. `.env`ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã¨APIã‚­ãƒ¼è¨­å®š
4. Jupyter Notebookèµ·å‹•
5. `notebooks/main.ipynb`ã‚’é–‹ã

### 10.2 ä½¿ç”¨æ–¹æ³•

1. ã‚»ãƒ«1ã€œ6ã‚’é †ç•ªã«å®Ÿè¡Œï¼ˆé–¢æ•°å®šç¾©ï¼‰
2. ã‚»ãƒ«7ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ`STATION_NAME`, `KEYWORD`ï¼‰ã‚’ç·¨é›†
3. ã‚»ãƒ«7ã‚’å®Ÿè¡Œ

## 11. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```txt
# requirements.txt
python-dotenv==1.0.0
googlemaps==4.10.0
numpy==1.24.3
pandas==2.0.3
mip==1.15.0
ipyleaflet==0.17.3
ipywidgets==8.1.0
jupyter==1.0.0
```

## 12. ä»Šå¾Œã®æ‹¡å¼µå¯èƒ½æ€§

1. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®UIåŒ–**: ipywidgetsã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
2. **è¤‡æ•°ãƒ«ãƒ¼ãƒˆæ¯”è¼ƒ**: æœ€é©è§£ä»¥å¤–ã®å€™è£œã‚‚è¡¨ç¤º
3. **è¨ªå•åº—èˆ—æ•°ã®å¯å¤‰åŒ–**: 10ä»¶ä»¥å¤–ã‚‚æŒ‡å®šå¯èƒ½ã«
4. **çµæœã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: CSVã€PDFå‡ºåŠ›æ©Ÿèƒ½

## 13. ä»˜éŒ²

### 13.1 ç”¨èªé›†

| ç”¨èª | èª¬æ˜ |
|------|------|
| TSP | å·¡å›ã‚»ãƒ¼ãƒ«ã‚¹ãƒãƒ³å•é¡Œ |
| MTZåˆ¶ç´„ | Miller-Tucker-Zemlinåˆ¶ç´„ï¼ˆéƒ¨åˆ†å·¡å›è·¯é™¤å»ï¼‰ |
| MIP | æ··åˆæ•´æ•°è¨ˆç”»æ³• |

---

**æ–‡æ›¸å±¥æ­´**

| ç‰ˆ | æ—¥ä»˜ | ä½œæˆè€… | å¤‰æ›´å†…å®¹ |
|----|------|--------|----------|
| 1.0 | 2025-11-07 | Claude Code | åˆç‰ˆä½œæˆ |
| 2.0 | 2025-11-07 | Claude Code | Jupyter Notebookå˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã«å¤‰æ›´ |
